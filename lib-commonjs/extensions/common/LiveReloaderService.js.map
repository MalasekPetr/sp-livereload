{"version":3,"file":"LiveReloaderService.js","sourceRoot":"","sources":["../../../src/extensions/common/LiveReloaderService.ts"],"names":[],"mappings":"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","sourcesContent":["import { ILiveReloaderSession, ILiveReloaderState } from \"./ILiveReloaderState\";\n\nconst SESSION_STORAGE_KEY = \"pnp-live-reloader\";\nconst SESSION_DEBUG_CONNECTED = \"spfx-debug\";\nconst PLACEMENT_STORAGE_KEY = \"pnp-live-reloader-placement\";\n// SPFx v1.21+ uses /temp/build/manifests.js\nconst DEBUG_QUERY_STRING = \"?debug=true&noredir=true&debugManifestsFile=https://localhost:4321/temp/build/manifests.js\";\n\nexport type PlacementPosition = 'top' | 'bottom';\n\nexport interface ILiveReloaderService {\n    available: boolean;\n    connected: boolean;\n    debugConnected: boolean;\n    placement: PlacementPosition;\n    state: { available: boolean; connected: boolean; debugConnected: boolean }\n}\n\nexport class LiveReloaderService implements ILiveReloaderService {\n\n    private _available?: boolean;\n    private _connected?: boolean;\n    private _debugConnected: boolean;\n    private _placement: PlacementPosition;\n\n    constructor() {\n\n        const storageItem = sessionStorage.getItem(SESSION_STORAGE_KEY);\n        const debugMode = sessionStorage.getItem(SESSION_DEBUG_CONNECTED);\n        const placementItem = localStorage.getItem(PLACEMENT_STORAGE_KEY);\n\n        if (storageItem === null) {\n            console.debug(' No storage entity found ');\n        } else {\n            const sessionSettings = JSON.parse(storageItem) as ILiveReloaderState;\n            sessionSettings.available = false;\n            this.state = sessionSettings;\n        }\n\n        if (debugMode !== null) {\n            this._debugConnected = true;\n        } else {\n            this._debugConnected = false;\n        }\n\n        // Initialize placement from localStorage, default to 'bottom'\n        if (placementItem === 'top' || placementItem === 'bottom') {\n            this._placement = placementItem;\n        } else {\n            this._placement = 'bottom';\n        }\n\n    }\n\n    private _updateSessionState(state: ILiveReloaderState): void {\n\n        const sessionState = {\n\n            connected: state.connected\n\n        } as ILiveReloaderSession;\n\n        sessionStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(sessionState));\n        this._connected = state.connected;\n\n    }\n\n    get available(): boolean {\n\n        if (this._available) {\n            return this._available;\n        } else {\n            return false;\n        }\n    }\n\n    set available(v: boolean) {\n        this._available = v;\n    }\n\n    get connected(): boolean {\n        if (this._connected) {\n            return this._connected;\n        } else {\n            return false;\n        }\n    }\n\n    set connected(v: boolean) {\n        const state = this.state;\n        state.connected = v;\n        this._updateSessionState(state);\n        this._connected = v;\n    }\n\n    set debugConnected(v: boolean) {\n\n        this._debugConnected = v;\n\n        if (!v) {\n            const sessionDebugItem = sessionStorage.getItem(SESSION_DEBUG_CONNECTED);\n            if (sessionDebugItem) {\n                sessionStorage.removeItem(SESSION_DEBUG_CONNECTED);\n            }\n            const refreshUrl = location.protocol + '//' + location.host + location.pathname;\n            window.location.href = refreshUrl;\n        } else {\n            const refreshUrl = location.protocol + '//' + location.host + location.pathname+DEBUG_QUERY_STRING;\n            window.location.href = refreshUrl;\n        }\n    }\n\n\n    get debugConnected(): boolean {\n        return this._debugConnected;\n    }\n\n    get placement(): PlacementPosition {\n        return this._placement;\n    }\n\n    set placement(v: PlacementPosition) {\n        this._placement = v;\n        localStorage.setItem(PLACEMENT_STORAGE_KEY, v);\n        // Reload the page to apply the new placement\n        window.location.reload();\n    }\n\n    get state() {\n        return {\n            available: this.available,\n            connected: this.connected,\n            debugConnected: this.debugConnected\n        }\n    }\n\n    set state(state: ILiveReloaderState) {\n\n        if (state.available) {\n\n            this._available = state.available;\n\n        }\n\n        if (state.connected) {\n\n            this._connected = state.connected;\n\n        }\n\n        if (state.debugConnected) {\n\n            this._debugConnected = state.debugConnected;\n\n        }\n\n        this._updateSessionState(state);\n\n    }\n\n}\n\nexport const lrs = new LiveReloaderService();"]}