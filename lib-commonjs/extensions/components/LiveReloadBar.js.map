{"version":3,"file":"LiveReloadBar.js","sourceRoot":"","sources":["../../../src/extensions/components/LiveReloadBar.ts"],"names":[],"mappings":";;AAIA,uEAAoD;AACpD,6CAA4C;AAC5C,2DAAwD;AACxD,iDAA0C;AAC1C,uCAAoC;AACpC,mDAAgD;AAChD,2CAAwC;AACxC,iDAA8C;AAE9C,MAAqB,aAAa;IAE9B,uBAAuB,GAAG,iBAAiB,CAAC;IAC5C,qBAAqB,GAAG,iDAAiD,CAAC;IAC1E,2BAA2B,GAAG,iCAAiC,CAAC;IAEhE,SAAS,CAA+B;IACxC,WAAW,CAAY;IAEvB,UAAU,CAAc;IACxB,aAAa,GAAG,IAAI,gBAAgB,EAAE,CAAC;IACvC,eAAe,CAAoB;IACnC,eAAe,CAAoB;IACnC,QAAQ,CAAU;IAClB,SAAS,CAAW;IACpB,UAAU,CAAc;IACxB,aAAa,CAAgB;IAC7B,gBAAgB,CAAgB;IAChC,OAAO,CAAY;IACnB,gBAAgB,CAAY;IAC5B,aAAa,CAAoB;IAEjC,gBAAgB,GAAG,CAAC,KAAY,EAAQ,EAAE;QACtC,iCAAiC;QACjC,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC7B,CAAC,CAAA;IAED,eAAe,GAAG,CAAC,KAAY,EAAQ,EAAE;QACrC,8CAA8C;QAC9C,yBAAG,CAAC,SAAS,GAAG,yBAAG,CAAC,SAAS,KAAK,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC;QAC3D,+DAA+D;IACnE,CAAC,CAAA;IAEO,iBAAiB;QAErB,gCAAgC;QAChC,IAAI,yBAAG,CAAC,SAAS,EAAE,CAAC;YAGhB,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;gBACpB,IAAI,CAAC,WAAW,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;YACjE,CAAC;YAED,IAAI,CAAC;gBACD,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,EAAE;oBAChD,IAAA,iBAAQ,EAAC,2BAA2B,EAAE,KAAK,CAAC,CAAA;gBAChD,CAAC,CAAC,CAAA;gBACF,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,KAAK,EAAE,EAAE;oBACnD,IAAI,KAAK,CAAC,IAAI,EAAE,CAAC;wBACb,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAyB,CAAC;wBAClE,IAAI,yBAAG,CAAC,KAAK,CAAC,SAAS,IAAI,UAAU,CAAC,OAAO,IAAI,UAAU,CAAC,OAAO,KAAK,QAAQ,EAAE,CAAC;4BAC/E,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;wBAC7B,CAAC;wBACD,IAAA,iBAAQ,EAAC,sBAAsB,EAAE,UAAU,CAAC,CAAC;oBACjD,CAAC;oBACD,IAAA,iBAAQ,EAAC,8BAA8B,EAAE,KAAK,CAAC,CAAA;gBACnD,CAAC,CAAC,CAAA;YACN,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBAEb,IAAA,iBAAQ,EAAC,mBAAmB,CAAC,CAAA;YAEjC,CAAC;QAEL,CAAC;IAEL,CAAC;IAED,YAAY,aAA0B,EAAE,QAAsC;QAE1E,IAAI,CAAC,UAAU,GAAG,aAAa,CAAC;QAChC,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAC1B,IAAI,CAAC,QAAQ,CAAC,yBAAG,CAAC,KAAK,CAAC,CAAC;QACzB,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAE7B,CAAC;IAED,IAAI;QACA,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAC1C,IAAI,CAAC,WAAW,GAAG,mBAAmB,CAAC;QACvC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QAElC,OAAO,IAAI,CAAC;IAChB,CAAC;IAEO,uBAAuB,GAAG,CAAC,KAAiB,EAAE,EAAE;QAEnD,IAAG,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAC,CAAC;YAC3C,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;QAC9B,CAAC;aAAM,CAAC;YACL,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QAC/B,CAAC;IACN,CAAC,CAAA;IAED,QAAQ,CAAC,KAAyB;QAE9B,MAAM,OAAO,GAAgB,QAAQ,CAAC,aAAa,CAAC,SAAS,CAAgB,CAAC;QAC9E,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE;YACnB,SAAS,EAAE,aAAa;SAC3B,CAAC,CAAA;QACF,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QAExC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;QAC5B,MAAM,SAAS,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,CAAC;QAE5C,MAAM,YAAY,GAAG,IAAI,6BAAa,CAAC,0BAA0B,EAAE,EAAE,SAAS,EAAE,sCAAsC,EAAE,EAAE,SAAS,CAAC,SAAS,CAAC,CAAC;QAC/I,YAAY,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,uBAAuB,CAAC,CAAC;QAErE,IAAI,CAAC,SAAS,GAAG,IAAI,uBAAQ,EAAE,CAAC;QAChC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QAE7C,IAAI,yBAAG,CAAC,cAAc,EAAE,CAAC;YACrB,IAAI,CAAC,aAAa,GAAG,IAAI,6BAAa,CAAC,4BAA4B,EAAE,EAAE,SAAS,EAAE,kBAAkB,EAAE,EAAE,SAAS,CAAC,SAAS,CAAC,CAAC;YAC7H,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,CAAC,EAAE;gBAC/C,yBAAG,CAAC,cAAc,GAAG,KAAK,CAAC;YAC/B,CAAC,CAAC,CAAC;QACP,CAAC;QACD,IAAI,CAAC,yBAAG,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,gBAAgB,GAAG,IAAI,6BAAa,CAAC,+BAA+B,EAAE,EAAE,SAAS,EAAE,iBAAiB,EAAE,EAAE,SAAS,CAAC,SAAS,CAAC,CAAC;YAClI,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,CAAC,EAAE;gBAClD,yBAAG,CAAC,cAAc,GAAG,IAAI,CAAC;YAC9B,CAAC,CAAC,CAAC;QACP,CAAC;QAED,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAEpC,IAAI,CAAC,aAAa,GAAG,IAAI,qCAAiB,CAAC,yBAAG,EAAE,OAAO,CAAC,CAAC;QAEzD,IAAI,CAAC,OAAO,GAAG,IAAI,qBAAS,CAAC,EAAE,aAAa,EAAE,cAAc,EAAE,WAAW,EAAE,WAAW,EAAE,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;QACrH,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC9D,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,yBAAG,CAAC,SAAS,CAAC;QAErC,IAAI,CAAC,gBAAgB,GAAG,IAAI,qBAAS,CAAC,EAAE,aAAa,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,EAAE,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;QACrH,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QACtE,IAAI,CAAC,gBAAgB,CAAC,OAAO,GAAG,yBAAG,CAAC,SAAS,KAAK,KAAK,CAAC;QACxD,4CAA4C;QAC5C,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,KAAK,GAAG,yBAAG,CAAC,SAAS,KAAK,KAAK,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC,kBAAkB,CAAC;QAG7G,MAAM,cAAc,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QACrD,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QAC/C,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QAE/B,MAAM,aAAa,GAAG,IAAI,6BAAa,CAAC,kBAAkB,EAAE,EAAE,SAAS,EAAE,qBAAqB,EAAE,EAAE,cAAc,CAAC,CAAC;QAElH,IAAI,CAAC,QAAQ,GAAG,IAAI,iBAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC5C,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QAE/C,aAAa,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE;YAEzC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC;YAEjF,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,CAAC;gBAE7C,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;YAElC,CAAC;iBAAM,CAAC;gBAEJ,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;YAEjC,CAAC;QAEL,CAAC,CAAC,CAAA;QAGF,IAAI,CAAC,QAAQ,EAAE,CAAC;QAEhB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAG/C,CAAC;IAED,IAAI,EAAE;QAEF,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;YACtB,MAAM,KAAK,CAAC,kCAAkC,CAAC,CAAC;QACpD,CAAC;QAED,OAAO,IAAI,CAAC,aAAa,CAAC,UAAyB,CAAC;IAExD,CAAC;IAED,QAAQ;QAEJ,IAAI,yBAAG,CAAC,SAAS,KAAK,SAAS,EAAE,CAAC;YAC9B,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,yBAAG,CAAC,SAAS,CAAC;YACrC,IAAI,CAAC,aAAa,CAAC,SAAS,GAAG,yBAAG,CAAC,SAAS,CAAC;QACjD,CAAC;QAED,IAAI,yBAAG,CAAC,SAAS,KAAK,SAAS,EAAE,CAAC;YAC9B,yBAAG,CAAC,SAAS,GAAG,CAAC,yBAAG,CAAC,SAAS,CAAA;YAC9B,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,yBAAG,CAAC,SAAS,CAAC;QACzC,CAAC;IAEL,CAAC;CAEJ;AApMD,gCAoMC","sourcesContent":["/* eslint-disable no-new */\nimport { IClientSideComponentManifest } from '@microsoft/sp-module-interfaces';\nimport { ILiveReloaderMessage } from '../common/ILiveReloaderMessage';\nimport { ILiveReloaderState } from '../common/ILiveReloaderState';\nimport { lrs } from '../common/LiveReloaderService';\nimport { LogDebug } from '../common/Logger';\nimport { AvailabilityState } from './AvailabilityState';\nimport { Branding } from './BrandingInfo';\nimport { Credits } from './Credits';\nimport { HooIconButton } from './HooIconButton';\nimport { HooToggle } from './HooToggle';\nimport { QuickActions } from './QuickActions';\n\nexport default class LiveReloadBar {\n\n    _LIVE_RELOAD_IDENTIFIER = \"PnP-Live-Reload\";\n    _LIVE_RELOADER_SOCKET = \"https://localhost:35729/livereload.js?snipver=1\";\n    _LIVE_RELOADER_SOCKET_ALERT = \"https://localhost:35729/changed\";\n\n    _mainfest: IClientSideComponentManifest;\n    _connection: WebSocket;\n\n    _parentDom: HTMLElement;\n    _domContainer = new DocumentFragment();\n    _stateAvailable: HTMLOutputElement;\n    _stateConnected: HTMLOutputElement;\n    _credits: Credits;\n    _branding: Branding;\n    _actionBar: HTMLElement;\n    _debugConnect: HooIconButton;\n    _debugDisconnect: HooIconButton;\n    _toggle: HooToggle;\n    _placementToggle: HooToggle;\n    _availability: AvailabilityState;\n\n    changeConnection = (event: Event): void => {\n        // lrs.connected = !lrs.connected\n        this.setState();\n        this.connectLiveReload();\n    }\n\n    changePlacement = (event: Event): void => {\n        // Toggle between 'top' and 'bottom' placement\n        lrs.placement = lrs.placement === 'top' ? 'bottom' : 'top';\n        // Note: lrs.placement setter triggers window.location.reload()\n    }\n\n    private connectLiveReload() {\n\n        // create a new <script> element\n        if (lrs.available) {\n\n\n            if (!this._connection) {\n                this._connection = new WebSocket(this._LIVE_RELOADER_SOCKET);\n            }\n\n            try {\n                this._connection.addEventListener('open', (event) => {\n                    LogDebug('Web Socket Event ::: OPEN', event)\n                })\n                this._connection.addEventListener('message', (event) => {\n                    if (event.data) {\n                        const msgCommand = JSON.parse(event.data) as ILiveReloaderMessage;\n                        if (lrs.state.connected && msgCommand.command && msgCommand.command === 'reload') {\n                            window.location.reload();\n                        }\n                        LogDebug('MESSAGE COMMAND ::::', msgCommand);\n                    }\n                    LogDebug('Web Socket Event ::: Message', event)\n                })\n            } catch (error) {\n\n                LogDebug('Failed to connect')\n\n            }\n\n        }\n\n    }\n\n    constructor(parentElement: HTMLElement, manifest: IClientSideComponentManifest) {\n\n        this._parentDom = parentElement;\n        this._mainfest = manifest;\n        this.updateUI(lrs.state);\n        this.connectLiveReload();\n\n    }\n\n    logo(): Node {\n        const logo = document.createElement('h2');\n        logo.textContent = \"PnP Live Reloader\";\n        logo.classList.add('pnp-lr-logo');\n\n        return logo;\n    }\n\n    private showBrandingInformation = (event: MouseEvent) =>{\n\n         if(!this._branding.Info.hasAttribute('open')){\n            this._branding.Info.show();\n         } else {\n            this._branding.Info.close();\n         }\n    }\n\n    updateUI(state: ILiveReloaderState) {\n\n        const section: HTMLElement = document.createElement('section') as HTMLElement;\n        Object.assign(section, {\n            classList: 'pnp-lr-base'\n        })\n        this._domContainer.appendChild(section);\n\n        section.append(this.logo());\n        const actionBar = new QuickActions(section);\n\n        const brandingInfo = new HooIconButton('icon-paint-bucket-filled', { ariaLabel: 'Show Branding and Design Information' }, actionBar.Container);\n        brandingInfo.addEventListener('click', this.showBrandingInformation);\n\n        this._branding = new Branding();\n        this._parentDom.prepend(this._branding.Info);\n\n        if (lrs.debugConnected) {\n            this._debugConnect = new HooIconButton('icon-plug-connected-filled', { ariaLabel: 'Enter Debug Mode' }, actionBar.Container);\n            this._debugConnect.addEventListener('click', evt => {\n                lrs.debugConnected = false;\n            });\n        }\n        if (!lrs.debugConnected) {\n            this._debugDisconnect = new HooIconButton('icon-plug-disconnected-filled', { ariaLabel: 'Exit Debug Mode' }, actionBar.Container);\n            this._debugDisconnect.addEventListener('click', evt => {\n                lrs.debugConnected = true;\n            });\n        }\n\n        section.append(actionBar.Container);\n\n        this._availability = new AvailabilityState(lrs, section);\n\n        this._toggle = new HooToggle({ labelInactive: \"Disconnected\", labelActive: \"Connected\" }, section, { tabIndex: -1 });\n        this._toggle.addEventListener('click', this.changeConnection);\n        this._toggle.enabled = lrs.connected;\n\n        this._placementToggle = new HooToggle({ labelInactive: \"Footer\", labelActive: \"Header\" }, section, { tabIndex: -1 });\n        this._placementToggle.addEventListener('click', this.changePlacement);\n        this._placementToggle.checked = lrs.placement === 'top';\n        // Set hover tooltip to show opposite action\n        this._placementToggle._inputToggle.title = lrs.placement === 'top' ? 'Toggle to Footer' : 'Toggle to Header';\n\n\n        const lrActionCredit = document.createElement('div');\n        lrActionCredit.classList.add('pnp-lr-actions');\n        section.append(lrActionCredit);\n\n        const creditsButton = new HooIconButton('icon-info-filled', { ariaLabel: 'Show / Hide Credits' }, lrActionCredit);\n\n        this._credits = new Credits(this._mainfest);\n        this._parentDom.prepend(this._credits.credits);\n\n        creditsButton.addEventListener('click', () => {\n\n            console.debug(this._credits.credits, this._credits.credits.hasAttribute('open'));\n\n            if (this._credits.credits.hasAttribute('open')) {\n            \n                this._credits.credits.close();\n            \n            } else {\n            \n                this._credits.credits.show();\n            \n            }\n\n        })\n\n\n        this.setState();\n\n        this._parentDom.append(this._domContainer);\n\n\n    }\n\n    get UI(): HTMLElement {\n\n        if (!this._domContainer) {\n            throw Error(\"LiveReloarderBar cannot be found\");\n        }\n\n        return this._domContainer.firstChild as HTMLElement;\n\n    }\n\n    setState() {\n\n        if (lrs.available !== undefined) {\n            this._toggle.enabled = lrs.available;\n            this._availability.available = lrs.available;\n        }\n\n        if (lrs.connected !== undefined) {\n            lrs.connected = !lrs.connected\n            this._toggle.checked = lrs.connected;\n        }\n\n    }\n\n}"]}